<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Создание заказа</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" th:href="@{/css/product_search_fragment.css}">
        <link rel="stylesheet" th:href="@{/css/create_order.css}">

    </head>
    <body>
        <!-- Меню навигации -->
        <div th:replace="~{fragments/navigate :: navigate}"></div>


        <div class="mobile-container">
            <!-- Сообщение -->
            <div th:if="${message != null}" class="alert alert-success" th:text="${message}" style="margin: 15px 0;"></div>
            <!-- Корзина -->
            <div th:replace="~{fragments/cart_for_order_fragment :: cart_for_order_fragment}"></div>

            <!-- Все продукты -->
            <div th:replace="~{fragments/productlist_for_order_fragment :: productlist_for_order_fragment}"></div>


        </div>

        <div th:replace="~{fragments/footer-fragment :: footer-fragment}"></div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // Валидация формы перед отправкой
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function (e) {
                    const requiredInputs = this.querySelectorAll('[required]');
                    let isValid = true;

                    requiredInputs.forEach(input => {
                        if (!input.value.trim()) {
                            input.style.borderColor = '#ff4444';
                            isValid = false;
                        }
                    });

                    if (!isValid) {
                        e.preventDefault();
                        alert('Пожалуйста, заполните все обязательные поля');
                    }
                });
            });

            // Сброс цвета границы при вводе
            document.querySelectorAll('[required]').forEach(input => {
                input.addEventListener('input', function () {
                    this.style.borderColor = '';
                });
            });
        </script>

        <script>
// Функция для переключения видимости корзины
            function toggleCart() {
                const cartContent = document.getElementById('cartContent');
                const toggleIcon = document.getElementById('cartToggleIcon');

                if (cartContent.classList.contains('cart-collapsed')) {
                    // Разворачиваем корзину
                    cartContent.classList.remove('cart-collapsed');
                    cartContent.classList.add('cart-expanded');
                    toggleIcon.textContent = '▲';
                    localStorage.setItem('cartExpanded', 'true');
                } else {
                    // Сворачиваем корзину
                    cartContent.classList.remove('cart-expanded');
                    cartContent.classList.add('cart-collapsed');
                    toggleIcon.textContent = '▼';
                    localStorage.setItem('cartExpanded', 'false');
                }
            }

// Инициализация при загрузке страницы
            document.addEventListener('DOMContentLoaded', function () {
                const cartContent = document.getElementById('cartContent');
                const toggleIcon = document.getElementById('cartToggleIcon');

                // Проверяем сохраненное состояние
                const savedState = localStorage.getItem('cartExpanded');

                if (savedState === 'true') {
                    // Если было развернуто - показываем
                    cartContent.classList.remove('cart-collapsed');
                    cartContent.classList.add('cart-expanded');
                    toggleIcon.textContent = '▲';
                } else {
                    // По умолчанию - свернуто
                    cartContent.classList.remove('cart-expanded');
                    cartContent.classList.add('cart-collapsed');
                    toggleIcon.textContent = '▼';
                }

                // Добавляем обработчик для клика по заголовку
                const cartTitle = document.querySelector('.cart-toggle-area');
                if (cartTitle) {
                    cartTitle.addEventListener('click', toggleCart);
                }
            });

// Функция для принудительного открытия корзины (например, при добавлении товара)
            function expandCart() {
                const cartContent = document.getElementById('cartContent');
                const toggleIcon = document.getElementById('cartToggleIcon');

                cartContent.classList.remove('cart-collapsed');
                cartContent.classList.add('cart-expanded');
                toggleIcon.textContent = '▲';
                localStorage.setItem('cartExpanded', 'true');
            }
        </script>
    </body>
</html>