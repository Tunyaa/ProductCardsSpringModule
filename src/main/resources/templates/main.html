<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="styles.css">
        <script src="script.js"></script>
        <title>Список продуктов</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" th:href="@{/css/calculator.css}">
        <link rel="stylesheet" th:href="@{/css/clock.css}">
    </head>
    <body>

        <div th:insert="~{fragments/navigate :: navigate}"></div>



        <div class="container my-5">

            <!-- Навигация в виде вкладок -->
            <ul class="nav nav-tabs mb-4" id="clockTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="time-tab" data-bs-toggle="tab" 
                            data-bs-target="#time" type="button" role="tab">Текущее время</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="stopwatch-tab" data-bs-toggle="tab" 
                            data-bs-target="#stopwatch" type="button" role="tab">Секундомер</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="timer-tab" data-bs-toggle="tab" 
                            data-bs-target="#timer" type="button" role="tab">Таймер (4 часа)</button>
                </li>
            </ul>

            <!-- Содержимое вкладок -->
            <div class="tab-content" id="clockTabsContent">
                <!-- Вкладка с текущим временем -->
                <div class="tab-pane fade show active" id="time" role="tabpanel">
                    <div class="clock-container">
                        <div id="clock" class="clock"></div>
                        <div id="date" class="date"></div>
                    </div>
                </div>

                <!-- Вкладка с секундомером -->
                <div class="tab-pane fade" id="stopwatch" role="tabpanel">
                    <div class="clock-container">
                        <div id="stopwatch-display" class="clock">00:00:00</div>
                        <div class="stopwatch-controls">
                            <button id="start-stopwatch" class="btn btn-success me-2">Старт</button>
                            <button id="lap-stopwatch" class="btn btn-info me-2">Круг</button>
                            <button id="reset-stopwatch" class="btn btn-danger">Сброс</button>
                        </div>
                        <div id="laps" class="laps-container mt-3"></div>
                    </div>
                </div>

                <!-- Вкладка с таймером -->
                <div class="tab-pane fade" id="timer" role="tabpanel">
                    <div class="clock-container">
                        <div id="timer-display" class="clock">04:00:00</div>
                        <div class="timer-controls">
                            <button id="start-timer" class="btn btn-success me-2">Старт</button>
                            <button id="pause-timer" class="btn btn-warning me-2">Пауза</button>
                            <button id="reset-timer" class="btn btn-danger">Сброс</button>
                        </div>
                        <div class="progress mt-3" style="height: 20px;">
                            <div id="timer-progress" class="progress-bar" style="width: 100%;">100%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">


            <div class="calculator">
                <div class="calculator-display">
                    <input type="text" id="display" readonly>
                </div>

                <div class="calculator-buttons">
                    <button onclick="clearDisplay()" class="btn-clear">C</button>
                    <button onclick="deleteLast()" class="btn-clear">⌫</button>
                    <button onclick="appendToDisplay('/')" class="btn-operator">/</button>
                    <button onclick="appendToDisplay('*')" class="btn-operator">×</button>

                    <button onclick="appendToDisplay('7')" class="btn-number">7</button>
                    <button onclick="appendToDisplay('8')" class="btn-number">8</button>
                    <button onclick="appendToDisplay('9')" class="btn-number">9</button>
                    <button onclick="appendToDisplay('-')" class="btn-operator">-</button>

                    <button onclick="appendToDisplay('4')" class="btn-number">4</button>
                    <button onclick="appendToDisplay('5')" class="btn-number">5</button>
                    <button onclick="appendToDisplay('6')" class="btn-number">6</button>
                    <button onclick="appendToDisplay('+')" class="btn-operator">+</button>

                    <button onclick="appendToDisplay('1')" class="btn-number">1</button>
                    <button onclick="appendToDisplay('2')" class="btn-number">2</button>
                    <button onclick="appendToDisplay('3')" class="btn-number">3</button>
                    <button onclick="calculate()" class="btn-equals" rowspan="2">=</button>

                    <button onclick="appendToDisplay('0')" class="btn-number" colspan="2">0</button>
                    <button onclick="appendToDisplay('.')" class="btn-number">.</button>
                </div>
            </div>
        </div>

        <script th:src="@{/js/calculator.js}"></script>

    </body>
    <script >
        let display = document.getElementById('display');

        function appendToDisplay(value) {
            display.value += value;
        }

        function clearDisplay() {
            display.value = '';
        }

        function deleteLast() {
            display.value = display.value.slice(0, -1);
        }

        function calculate() {
            try {
                // Заменяем × на * для вычислений
                let expression = display.value.replace(/×/g, '*');
                let result = eval(expression);

                // Округляем до 2 знаков после запятой
                if (Number.isFinite(result)) {
                    display.value = Number(result.toFixed(2));
                } else {
                    display.value = 'Ошибка';
                }
            } catch (error) {
                display.value = 'Ошибка';
            }
        }

        // Поддержка клавиатуры
        document.addEventListener('keydown', function (event) {
            if (/[0-9\.\+\-\*\/]/.test(event.key)) {
                appendToDisplay(event.key);
            } else if (event.key === 'Enter') {
                calculate();
            } else if (event.key === 'Escape') {
                clearDisplay();
            } else if (event.key === 'Backspace') {
                deleteLast();
            }
        });
    </script>
    <script th:src="@{/js/clock.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</html>